#!/bin/python3
import apt
import sys
import yaml

print("Starting ! \n")


### Function installing given as variable package #######

def install_package(pkg_name):
	print("Updating cache, please wait !")
	pkg_cache=apt.Cache()
	pkg_cache.update()
	pkg_cache.open(None)
	pkg_cache.upgrade()
#	pkg_name = input("Type package you want for install of check if installed \n")
	try:
		inst_pkg = pkg_cache[pkg_name]
		print("inst_package = " + pkg_name)
		if inst_pkg.is_installed:
			print("{} already installed".format(pkg_name))
		else:
			inst_pkg.mark_install()
			try:
				print("Installing ' " + pkg_name + " ' please wait")
				pkg_cache.commit()
			except arg:
				print(" >>", sys.stderr, "Sorry, package install failed [{err}]".format(err=str(arg)))
	except KeyError:
		print(" Package ' " + pkg_name + " '  was not found")


###### Function reading the yaml file and extracting the 'Packages' section
###### to install all the packages

def import_package_file():
	print("Starting Import package")
	with open('config_files/items.yaml') as file:
		data = yaml.load(file, Loader=yaml.FullLoader)
		print(data)
		for key in data.keys():
			if key == "packages":
				print("Installing {} -  {}" .format(key,data[key]))
				package_list=data[key]
				value=0
				max=len(package_list)
				print(max)
				for value in range(0,max):
					print(package_list[value])

#					install_package(package_list[value])
#			else:
#				print("Other param boucle")


####################################################
#              MAIN PROGRAM                        #
####################################################

import_package_file()
